var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-y5S3hZEA.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i=s();class a extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class h extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i,a,h=100,r=!0){super(e,s,i,a),t(this,"hp"),t(this,"maxHp"),t(this,"healthBar"),this.hp=h,this.maxHp=h,e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.healthBar=e.add.graphics(),this.healthBar.setVisible(r),this.healthBar.setDepth(1e3),this.updateHealthBar()}hit(e){const t=this.hp;if(this.hp-=e,this.showFloatingCombatText(this.x,this.y,e.toString(),"#ffff00"),this.scene.tweens.add({targets:this,tint:16711680,alpha:.8,duration:100,ease:"Linear",yoyo:!0,repeat:2,onComplete:()=>{this.clearTint()}}),this.hp<=0&&t>0){const e=this.scene;this.healthBar.destroy(),this.scene.tweens.add({targets:this,duration:200,ease:"Back.easeIn",scaleX:0,scaleY:0,rotation:Phaser.Math.DegToRad(50),onComplete:()=>{let t=42+Math.floor(10.5*e.player.level);t+=20,e.player.gainExperience(t),this.destroy()}})}}showFloatingCombatText(e,t,s,i="#ff0000",a="16px Arial"){const h=Phaser.Math.Between(-15,15),r=Phaser.Math.Between(-9,14),l=this.scene.add.text(e+h,t+r,`${s}`,{font:a,color:i,stroke:"#000000",strokeThickness:2}),n=Phaser.Math.Between(-10,10),o=Phaser.Math.Between(-30,-50);this.scene.tweens.add({targets:l,x:l.x+n,y:l.y+o,alpha:0,duration:800,ease:"Cubic",onComplete:()=>{l.destroy()}})}updateHealthBar(){this.healthBar.clear();const e=this.x-20,t=this.y-this.height/2+30,s=Math.max(this.hp/this.maxHp,0);this.healthBar.fillStyle(0,1),this.healthBar.fillRect(e,t,40,5),this.healthBar.fillStyle(16711680,1),this.healthBar.fillRect(e+1,t+1,38*s,3)}preUpdate(e,t){super.preUpdate(e,t),this.updateHealthBar()}}class r extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i,a,h){super(e,s,i,a),t(this,"owner"),t(this,"enemiesHitCount",0),t(this,"targetsHit"),this.owner=h,e.add.existing(this),e.spells.add(this),e.physics.add.existing(this),this.targetsHit=new Set,this.setDepth(10)}}class l extends r{constructor(e,t,s,i){super(e,t,s,"projectile-spell",i)}cast(e,t,s){this.anims.play("projectile-spell-anim"),this.setScale(.66),this.setTint(16777215);const i=Phaser.Math.Between(-50,50);this.scene.tweens.add({targets:this,angle:{from:0,to:i},duration:400,ease:"Linear"}),this.setVelocityX(e*t),this.setVelocityY(s),this.setGravityY(-2500),this.scene.time.delayedCall(1e3,(()=>{this.active&&this.destroy()}))}}class n extends h{constructor(e,s,i,a){var h;super(e,s,i,a,100,!1),t(this,"level",1),t(this,"levelXp",0),t(this,"xpToNextLevel",800),t(this,"isInvincible",!1),t(this,"isLevelUpEffectActive",!1),t(this,"levelUpEffect",null),t(this,"isAttacking",!1),this.setGravityY(2e3),this.setDepth(10),null==(h=this.body)||h.setSize(60,70).setOffset(30,60)}hit(e){this.isInvincible||(this.hp-=e,this.showFloatingCombatText(this.x,this.y,`${e}`),this.scene.tweens.add({targets:this,alpha:.1,duration:100,ease:"Linear",yoyo:!0,repeat:4,onActive:()=>{this.isInvincible=!0},onComplete:()=>{this.isInvincible=!1,this.setAlpha(1)}}))}gainExperience(e){this.levelXp+=e,this.showFloatingCombatText(this.x,this.y-10,`XP: ${e}`,"#8a2be2","12px Arial"),this.levelXp>=this.xpToNextLevel&&(this.levelXp-=this.xpToNextLevel,console.log(this.level),this.level++,this.hp=100,this.xpToNextLevel+=800,this.scene.showToast("LEVEL UP!","20px Arial"),this.triggerLevelUpEffect()),this.scene.updateExperienceBar(),this.scene.updateLevelText()}triggerLevelUpEffect(){if(this.isLevelUpEffectActive)return;this.levelUpEffect=this.scene.add.sprite(this.x,this.y,"levelUpEffect"),this.levelUpEffect.setDepth(10),this.levelUpEffect.play("levelUpAnim"),this.scene.sound.play("lightning-shield",{volume:.5,loop:!0});const e=this.scene.time.addEvent({delay:16,callback:()=>{this.levelUpEffect&&this.levelUpEffect.setPosition(this.x,this.y),this.isLevelUpEffectActive=!0,this.isInvincible=!0},callbackScope:this,loop:!0});this.scene.time.delayedCall(5e3,(()=>{this.scene.sound.stopByKey("lightning-shield"),e.remove(!1),this.levelUpEffect&&(this.levelUpEffect.destroy(),this.levelUpEffect=null),this.isLevelUpEffectActive=!1,this.isInvincible=!1}))}async castLightningSpell(){if(this.isAttacking)return;this.isAttacking=!0;const e=this.flipX?-1:1,t=80*e,s=Array.from({length:Math.min(this.level,16)},((e,t)=>0===t?12:t-1+12));this.anims.play("wizard-attack"),this.scene.time.delayedCall(200,(()=>{let i=!1;s.forEach(((a,h)=>{this.scene.time.delayedCall(20*h,(()=>{const r=new l(this.scene,this.x+t,this.y+a-15,this);r.owner=this,r.cast(e,1e3,10*a),i||(this.scene.sound.play("lightning-bolt",{volume:.35,detune:Phaser.Math.Between(-500,500)}),i=!0),h===s.length-1&&(this.isAttacking=!1,this.anims.play("wizard-idle"))}))}))}))}handleMovement(){var e,t,s,i,a,h;try{this.scene.input.activePointer.worldX<this.x?this.flipX=!0:this.flipX=!1,this.scene.input.keyboard&&(this.scene.cursorKeys.left.isDown||this.scene.keyboardKeys.A.isDown?(this.flipX=!0,(null==(e=this.body)?void 0:e.blocked.down)&&!this.isAttacking&&this.anims.play("wizard-run",!0),this.setVelocityX(-400)):this.scene.cursorKeys.right.isDown||this.scene.keyboardKeys.D.isDown?(this.flipX=!1,(null==(t=this.body)?void 0:t.blocked.down)&&!this.isAttacking&&this.anims.play("wizard-run",!0),this.setVelocityX(400)):((null==(s=this.body)?void 0:s.blocked.down)&&!this.isAttacking&&this.anims.play("wizard-idle",!0),this.setVelocityX(0)),((null==(i=this.scene.cursorKeys.space)?void 0:i.isDown)||(null==(a=this.scene.cursorKeys.up)?void 0:a.isDown)||this.scene.keyboardKeys.W.isDown)&&(null==(h=this.body)?void 0:h.blocked.down)&&(this.anims.play("wizard-jump"),this.scene.sound.play("jump",{volume:.2}),this.setVelocityY(-800)))}catch(r){}}update(){this.handleMovement()}}class o extends h{constructor(e,s,i,a){super(e,s,i,a,50),t(this,"isAttacking",!1),t(this,"canAttack",!0),t(this,"isDazed",!1)}chasePlayer(e){var t,s;if(null==(t=this.body)||t.setSize(40,40).setOffset(40,40),this.active){new Phaser.Math.Vector2(e.x-this.x,e.y-this.y).normalize().x<0?this.setFlipX(!0):this.setFlipX(!1);const t=e.x>this.x?1:-1,i=Math.abs(e.x-this.x),a=Math.abs(e.y-this.y);if(i<=20&&a<=20&&this.canAttack&&!1===this.isAttacking&&0===Phaser.Math.Between(0,10)){this.isAttacking=!0,this.canAttack=!1,this.anims.play("char-attack");const s=this.scene.add.rectangle(this.x+(this.flipX?-20:20),this.y,20,20);this.scene.physics.add.existing(s),s.body.setAllowGravity(!1);let i=0;this.scene.physics.add.overlap(s,e,(()=>{if(!e.isInvincible&&0===i){const t=Phaser.Math.Between(5,15);e.hit(t),i++}}),void 0,this),this.scene.time.delayedCall(2500,(()=>{this.isAttacking=!1,this.canAttack=!0})),this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{this.isAttacking=!1,s.destroy(),this.isDazed?this.anims.play("char-idle",!0):(this.anims.play("char-running",!0),this.setVelocityX(80*t))})),this.scene.time.delayedCall(250,(()=>{s.active&&s.destroy()}))}else i>20&&!1===this.isAttacking&&(this.isDazed||(this.anims.play("char-running",!0),this.setVelocityX(80*t)));(null==(s=this.body)?void 0:s.blocked.down)&&0===Phaser.Math.Between(0,600)&&(this.anims.play("char-jump"),this.setVelocityY(Phaser.Math.Between(-200,-800)),this.setVelocityX(80*t))}}}const c=2e3;class d extends i.Scene{constructor(){super("Game"),t(this,"platforms"),t(this,"characters"),t(this,"player"),t(this,"enemies"),t(this,"spells"),t(this,"cursorKeys"),t(this,"keyboardKeys"),t(this,"attackKey"),t(this,"healthBar"),t(this,"experienceBar"),t(this,"levelText"),t(this,"toastMessages",[])}preload(){this.load.spritesheet("wizard-idle","assets/characters/wizard/idle.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("wizard-run","assets/characters/wizard/run.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("wizard-jump","assets/characters/wizard/jump.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("wizard-attack","assets/characters/wizard/attack.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("char-idle","assets/char-idle.png",{frameWidth:120,frameHeight:80}),this.load.spritesheet("char-running","assets/char-running.png",{frameWidth:120,frameHeight:80}),this.load.spritesheet("char-jump","assets/char-jump.png",{frameWidth:120,frameHeight:80}),this.load.spritesheet("char-attack","assets/char-attack.png",{frameWidth:120,frameHeight:80}),this.load.spritesheet("projectile-spell","assets/lightning-bolt.png",{frameWidth:256,frameHeight:128}),this.load.spritesheet("levelUpEffect","assets/lightning-shield.png",{frameWidth:128,frameHeight:128})}create(){var e;this.add.tileSprite(0,-20,c,f,"bg").setOrigin(0,0).setAlpha(.5),this.sound.add("music",{loop:!0,volume:1}).play(),this.physics.world.setBounds(0,0,c,f),this.cameras.main.setBounds(250,-15,1500,f),this.platforms=this.physics.add.group({immovable:!0,allowGravity:!1}),this.createPlatforms(),this.player=new n(this,1e3,f-100,"wizard-idle"),this.player.setScale(.66),this.cameras.main.startFollow(this.player,!0,5,5),this.characters=this.physics.add.group(),this.characters.add(this.player),this.enemies=this.physics.add.group({classType:o,runChildUpdate:!0}),this.spells=this.physics.add.group(),this.physics.add.collider(this.characters,this.platforms),this.physics.add.overlap(this.spells,this.platforms,(e=>{this.time.delayedCall(1e3,(()=>{e.destroy()}))})),this.physics.add.overlap(this.spells,this.characters,((e,t)=>this.handleSpellCollision(e,t)),void 0,this),this.physics.add.overlap(this.enemies,this.player,((e,t)=>{const s=t;this.player.isLevelUpEffectActive&&this.hitTarget(s,20)}),void 0,this),this.createAnimations(),this.input.keyboard&&(this.cursorKeys=this.input.keyboard.createCursorKeys(),this.keyboardKeys=null==(e=this.input.keyboard)?void 0:e.addKeys({W:Phaser.Input.Keyboard.KeyCodes.W,A:Phaser.Input.Keyboard.KeyCodes.A,S:Phaser.Input.Keyboard.KeyCodes.S,D:Phaser.Input.Keyboard.KeyCodes.D,F:Phaser.Input.Keyboard.KeyCodes.F})),this.healthBar=this.add.graphics(),this.healthBar.setScrollFactor(0),this.updateHealthBar(),this.experienceBar=this.add.graphics(),this.experienceBar.setScrollFactor(0),this.updateExperienceBar(),this.levelText=this.add.text(24,60,"",{font:"16px Arial",color:"#ffffff",stroke:"#000000",strokeThickness:1}),this.levelText.setScrollFactor(0),this.updateLevelText(),this.time.addEvent({delay:500,callback:this.spawnEnemies,callbackScope:this,loop:!0})}createPlatforms(){const e=(e,t,s=1,i=1,a=0)=>{this.platforms.create(e,t,"ground").setScale(s,i).setTint(a).setOrigin(.5,.5).setAlpha(.5).setDepth(1e3).refreshBody()},t=Math.ceil(10)+1;for(let i=0;i<t;i++)e(200*i,300,1,1);const s=f;e(0,f/2,1,s/20),e(c,f/2,1,s/20)}createAnimations(){this.anims.exists("wizard-idle")||this.anims.create({key:"wizard-idle",frames:this.anims.generateFrameNumbers("wizard-idle",{start:0,end:7}),frameRate:12,repeat:-1}),this.anims.exists("wizard-run")||this.anims.create({key:"wizard-run",frames:this.anims.generateFrameNumbers("wizard-run",{start:0,end:7}),frameRate:12,repeat:-1}),this.anims.exists("wizard-jump")||this.anims.create({key:"wizard-jump",frames:this.anims.generateFrameNumbers("wizard-jump",{start:0,end:7}),frameRate:12,repeat:0}),this.anims.exists("wizard-attack")||this.anims.create({key:"wizard-attack",frames:this.anims.generateFrameNumbers("wizard-attack",{start:0,end:8}),frameRate:40,repeat:0}),this.anims.exists("char-idle")||this.anims.create({key:"char-idle",frames:this.anims.generateFrameNumbers("char-idle",{start:0,end:9}),frameRate:10,repeat:-1}),this.anims.exists("char-running")||this.anims.create({key:"char-running",frames:this.anims.generateFrameNumbers("char-running",{start:0,end:9}),frameRate:16,repeat:-1}),this.anims.exists("char-attack")||this.anims.create({key:"char-attack",frames:this.anims.generateFrameNumbers("char-attack",{start:0,end:5}),frameRate:24,repeat:0}),this.anims.exists("char-jump")||this.anims.create({key:"char-jump",frames:this.anims.generateFrameNumbers("char-jump",{start:0,end:2}),frameRate:5,repeat:0}),this.anims.exists("projectile-spell-anim")||this.anims.create({key:"projectile-spell-anim",frames:this.anims.generateFrameNumbers("projectile-spell",{start:0,end:3}),frameRate:12,repeat:-1}),this.anims.exists("levelUpAnim")||this.anims.create({key:"levelUpAnim",frames:this.anims.generateFrameNumbers("levelUpEffect",{start:0,end:3}),frameRate:40,repeat:-1})}spawnEnemies(){if(this.enemies.countActive()>10)return;const e=0===Phaser.Math.Between(0,1);let t;do{t=e?Phaser.Math.Between(100,1e3):Phaser.Math.Between(1e3,1900)}while(Math.abs(t-this.player.x)<290);const s=new o(this,t,200,"char-idle");this.enemies.add(s),this.characters.add(s)}handlePlayerDamage(e){this.player.hit(e),this.updateHealthBar(),this.evaluateGameOver()}hitTarget(e,t=0){0===t&&(t=this.calculateDamage(e)),e.hit(t)}handleSpellCollision(e,t){if(!e.targetsHit.has(t))if(e.targetsHit.add(t),e.owner instanceof n&&t instanceof o){if(this.hitTarget(t),e.enemiesHitCount++,Phaser.Math.Between(1,100)<=20){t.isDazed=!0;const s=t.x>e.x?1:-1;t.setVelocityX(200*s),this.time.delayedCall(300,(()=>{t.isDazed=!1}))}e.enemiesHitCount>=3&&this.tweens.add({targets:e,alpha:0,duration:100,onComplete:()=>{e.destroy()}})}else e.owner instanceof o&&t instanceof n&&this.hitTarget(t)}calculateDamage(e){return e===this.player?Phaser.Math.Between(5,10):e instanceof o?Phaser.Math.Between(2,10):0}updateHealthBar(){this.healthBar.clear(),this.healthBar.fillStyle(16711680,1),this.healthBar.fillRect(12,8,.8*this.player.hp,5),this.healthBar.lineStyle(1,0),this.healthBar.strokeRect(12,8,80,5)}updateExperienceBar(){this.experienceBar.clear(),this.experienceBar.fillStyle(9055202,1);const e=Math.min(this.player.levelXp/this.player.xpToNextLevel*80,80);this.experienceBar.fillRect(12,16,e,3),this.experienceBar.lineStyle(1,0),this.experienceBar.strokeRect(12,16,80,3)}updateLevelText(){this.levelText.setText(`${this.player.level}`),this.levelText.setFontSize(15),this.levelText.setPosition(y-20,4)}evaluateGameOver(){this.player.hp<=0&&(this.scene.stop(),this.player.hp=100,this.scene.start("GameOver",{level:this.player.level}),this.sound.stopAll())}chasePlayer(){this.enemies.getChildren().forEach((e=>{e.chasePlayer(this.player)}))}gameOverOnFallOutOfWorld(){this.player.y>f&&(this.player.hp=0,this.evaluateGameOver())}handleCastSpells(){this.input.activePointer.isDown&&this.player.castLightningSpell()}showToast(e,t="14px Arial"){const s=this.add.text(0,0,e,{font:t,color:"#ffffff",stroke:"#000000",strokeThickness:2});s.setScrollFactor(0),s.setX(y/2-s.width/2),s.setY(f/2-100),this.toastMessages.push(s),this.tweens.add({targets:s,y:s.y+20*this.toastMessages.length,duration:300,ease:"Power2"}),this.time.delayedCall(1e3,(()=>{this.toastMessages=this.toastMessages.filter((e=>e!==s)),s.destroy(),this.toastMessages.forEach(((e,t)=>{this.tweens.add({targets:e,y:10+20*t,duration:300,ease:"Power2"})}))}))}update(){this.evaluateGameOver(),this.player.update(),this.handleCastSpells(),this.chasePlayer(),this.updateHealthBar(),this.gameOverOnFallOutOfWorld()}}class p extends i.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text"),t(this,"level",0)}init(e){this.level=e.level}create(){var e;const t=this.scale.width/2,s=this.scale.height/2;this.background=this.add.image(0,0,"background"),this.scene.stop("Game"),this.gameover_text=this.add.text(t,s,`\nLevel Reached: ${this.level||0}`,{fontFamily:"Arial Black",fontSize:30,color:"#fff",stroke:"#000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5);const i=null==(e=this.input.keyboard)?void 0:e.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);null==i||i.once("down",(()=>{this.scene.start("MainMenu")})),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}class m extends i.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"title"),t(this,"subtitle")}create(){var e;const t=this.scale.width/2,s=this.scale.height/2;this.background=this.add.image(t,s,"background"),this.background.setAlpha(.2),this.subtitle=this.add.text(t,s,"PRESS SPACE OR TAP TO START",{fontFamily:"Arial Black",fontSize:22,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5);const i=null==(e=this.input.keyboard)?void 0:e.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);null==i||i.once("down",(()=>{this.scene.start("Game")})),this.input.once("pointerdown",(()=>{this.time.delayedCall(50,(()=>{this.scene.start("Game")}))}))}}class u extends i.Scene{constructor(){super("Preloader"),t(this,"background")}init(){const e=this.scale.width/2,t=this.scale.height/2;this.background=this.add.image(e,t,"background"),this.background.setAlpha(.2),this.add.rectangle(y/2,f/2,y-172,32).setStrokeStyle(1,16777215);const s=this.add.rectangle(y/2-(y-172)/2+2,f/2,4,28,16777215);this.load.on("progress",(e=>{s.width=4+(y-176)*e}))}preload(){this.load.image("bg","assets/bg.png"),this.load.image("ground","assets/platform.png"),this.load.audio("tap","assets/audio/tap.wav"),this.load.audio("lightning-bolt","assets/audio/lightning-bolt.wav"),this.load.audio("music","assets/audio/music.mp3"),this.load.audio("lightning-shield","assets/audio/lightning-shield.wav"),this.load.audio("jump","assets/audio/jump.wav")}create(){this.scene.start("MainMenu")}}const y=640,f=320,g={type:Phaser.AUTO,width:y,height:f,pixelArt:!0,roundPixels:!0,zoom:6,parent:"game-container",backgroundColor:"#000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:2e3},debug:!1}},scene:[a,u,m,d,p]};new i.Game(g);
