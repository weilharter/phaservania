var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{p as s}from"./phaser-CwoquCe3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class a extends s.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}const i=2e3;class r extends s.Scene{constructor(){super("Game"),t(this,"level",10),t(this,"levelXp",0),t(this,"xpToNextLevel",1e4),t(this,"player"),t(this,"playerHp",100),t(this,"playerIsInvincible",!1),t(this,"platforms"),t(this,"enemies"),t(this,"spells"),t(this,"characters"),t(this,"cursorKeys"),t(this,"keyboardKeys"),t(this,"healthBar"),t(this,"experienceBar"),t(this,"levelText"),t(this,"playerCanAttack",!0),t(this,"attackKey")}preload(){this.load.image("sky","assets/background/sky.png"),this.load.image("ground","assets/platform.png"),this.load.spritesheet("charmodel","assets/charmodel.png",{frameWidth:32,frameHeight:48}),this.load.spritesheet("spell","assets/projectiles.png",{frameWidth:64,frameHeight:64})}create(){var e;this.add.tileSprite(0,0,i,n,"sky").setOrigin(0,0),this.player=this.physics.add.sprite(100,400,"charmodel"),this.player.setCollideWorldBounds(!0),this.player.setGravityY(2e3),this.physics.world.setBounds(0,0,i,n),this.cameras.main.setBounds(0,0,i,n),this.cameras.main.startFollow(this.player,!0,.1,.1),this.platforms=this.physics.add.group({immovable:!0,allowGravity:!1}),this.createPlatforms(),this.enemies=this.physics.add.group(),this.spells=this.physics.add.group(),this.characters=this.physics.add.group(),this.characters.add(this.player),this.physics.add.collider(this.characters,this.platforms),this.physics.add.overlap(this.spells,this.platforms,(e=>{e.destroy()})),this.physics.add.overlap(this.spells,this.characters,this.handleSpellCollision,void 0,this),this.physics.add.overlap(this.enemies,this.player,((e,t)=>{if(!this.playerIsInvincible){const e=Phaser.Math.Between(5,15);this.handlePlayerDamage(e)}}),void 0,this),this.createAnimations(),this.input.keyboard&&(this.cursorKeys=this.input.keyboard.createCursorKeys(),this.keyboardKeys=null==(e=this.input.keyboard)?void 0:e.addKeys({W:Phaser.Input.Keyboard.KeyCodes.W,A:Phaser.Input.Keyboard.KeyCodes.A,S:Phaser.Input.Keyboard.KeyCodes.S,D:Phaser.Input.Keyboard.KeyCodes.D,F:Phaser.Input.Keyboard.KeyCodes.F})),this.healthBar=this.add.graphics(),this.healthBar.setScrollFactor(0),this.updateHealthBar(),this.experienceBar=this.add.graphics(),this.experienceBar.setScrollFactor(0),this.updateExperienceBar(),this.levelText=this.add.text(16,60,"",{font:"16px Arial",color:"#ffffff",stroke:"#000000",strokeThickness:2}),this.levelText.setScrollFactor(0),this.updateLevelText(),this.time.addEvent({delay:250,callback:this.spawnEnemies,callbackScope:this,loop:!0})}createPlatforms(){const e=Math.ceil(5)+1;for(let t=0;t<e;t++)this.platforms.create(400*t,550+Phaser.Math.Between(-10,10),"ground").setScale(1).refreshBody()}createAnimations(){this.anims.exists("left")||this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("charmodel",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.exists("front")||this.anims.create({key:"front",frames:[{key:"charmodel",frame:4}],frameRate:20}),this.anims.exists("right")||this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("charmodel",{start:5,end:8}),frameRate:10,repeat:-1}),this.anims.exists("spellAnim")||this.anims.create({key:"spellAnim",frames:this.anims.generateFrameNumbers("spell",{start:3,end:5}),frameRate:15}),this.player.anims.play("front")}handleMovement(){var e,t,s;this.input.keyboard&&(this.cursorKeys.left.isDown||this.keyboardKeys.A.isDown?this.player.setVelocityX(-500):this.cursorKeys.right.isDown||this.keyboardKeys.D.isDown?this.player.setVelocityX(500):(this.player.setVelocityX(0),this.player.anims.play("front")),((null==(e=this.cursorKeys.space)?void 0:e.isDown)||(null==(t=this.cursorKeys.up)?void 0:t.isDown)||this.keyboardKeys.W.isDown)&&(null==(s=this.player.body)?void 0:s.touching.down)&&this.player.setVelocityY(-900)),this.input.activePointer.worldX<this.player.x?this.player.anims.play("left",!0):this.player.anims.play("right",!0)}castPlayerSpell(){var e;if(!this.playerCanAttack)return;this.playerCanAttack=!1;const t="left"==(null==(e=this.player.anims.currentAnim)?void 0:e.key)?-1:1,s=25*t;Array.from({length:this.level},((e,t)=>-60-10*t)).forEach((e=>{const a=this.spells.create(this.player.x+s,this.player.y+e+30,"spell");a.anims.play("spellAnim"),a.setVelocityX(1e3*t),a.setGravityY(-1400),a.owner="player",this.time.delayedCall(2e3,(()=>{a.active&&a.destroy()}))})),this.time.delayedCall(500,(()=>{this.playerCanAttack=!0}))}spawnEnemies(){if(this.enemies.countActive(!0)>=50)return;const e=0===Phaser.Math.Between(0,1);let t;do{t=e?Phaser.Math.Between(0,1e3):Phaser.Math.Between(1e3,i)}while(Math.abs(t-this.player.x)<450);const s=this.enemies.create(t,500,"charmodel");s.setCollideWorldBounds(!0),s.anims.play("front"),s.hp=100,s.isEnemy=!0,s.setTint(16711680),this.characters.add(s);let a="left";this.time.addEvent({delay:50,callback:()=>{s.active&&(a="left"===a?"right":"left",s.anims.play(a,!0))},callbackScope:this,loop:!0})}enemyAttack(e){if(!e.active)return;const t=new Phaser.Math.Vector2(this.player.x-e.x,this.player.y-e.y).normalize(),s=this.spells.create(e.x,e.y-60,"spell");s.setVelocity(1e3*t.x,1e3*t.y),s.setGravityY(-1e3),s.setTint(16711680),s.owner="enemy",s.anims.play("spellAnim"),this.time.delayedCall(2e3,(()=>{s.destroy()}))}handlePlayerDamage(e){this.playerHp-=e,this.showDamageNumber(this.player.x,this.player.y,e),this.updateHealthBar(),this.evaluateGameOver(),this.playerIsInvincible=!0,this.tweens.add({targets:this.player,alpha:0,duration:100,ease:"Linear",yoyo:!0,repeat:5,onComplete:()=>{this.player.setAlpha(1)}}),this.time.delayedCall(1e3,(()=>{this.playerIsInvincible=!1}))}handleSpellCollision(e,t){if("player"===e.owner&&t.isEnemy){const s=this.calculateDamage(t);t.hp-=s,this.showDamageNumber(t.x,t.y,s,"#ffff00"),t.hp<=0&&(t.destroy(),this.gainExperience(1e3)),e.destroy()}else if("enemy"===e.owner&&t===this.player){if(!this.playerIsInvincible){const e=this.calculateDamage(this.player);this.handlePlayerDamage(e)}e.destroy()}}calculateDamage(e){return e===this.player?Phaser.Math.Between(5,10):e.isEnemy?Phaser.Math.Between(100,200):0}showDamageNumber(e,t,s,a="#ff0000"){const i=this.add.text(e,t,`${s}`,{font:"16px Arial",color:a,stroke:"#000000",strokeThickness:2});this.tweens.add({targets:i,y:t-30,alpha:.1,duration:500,ease:"Power1",onComplete:()=>{i.destroy()}})}updateHealthBar(){this.healthBar.clear(),this.healthBar.fillStyle(16711680,1),this.healthBar.fillRect(16,16,2*this.playerHp,20),this.healthBar.lineStyle(1,0),this.healthBar.strokeRect(16,16,200,20)}updateExperienceBar(){this.experienceBar.clear(),this.experienceBar.fillStyle(65280,1);const e=Math.min(this.levelXp/this.xpToNextLevel*200,200);this.experienceBar.fillRect(16,40,e,10),this.experienceBar.lineStyle(1,0),this.experienceBar.strokeRect(16,40,200,10)}updateLevelText(){this.levelText.setText(`Level: ${this.level}\nXP: ${this.levelXp} / ${this.xpToNextLevel}`)}gainExperience(e){this.levelXp+=e,this.levelXp>=this.xpToNextLevel&&(this.levelXp-=this.xpToNextLevel,this.level++,this.playerHp=100,this.xpToNextLevel+=5e3),this.updateExperienceBar(),this.updateLevelText()}evaluateGameOver(){this.playerHp<=0&&(this.scene.stop(),this.playerHp=100,this.scene.start("GameOver"))}update(){this.handleMovement(),this.updateHealthBar(),this.evaluateGameOver(),this.input.activePointer.isDown&&this.castPlayerSpell(),this.enemies.getChildren().forEach((e=>{var t;if(e.active){const s=Math.abs(this.player.x-e.x);if(s<20){const t=this.player.x>e.x?-1:1;e.setVelocityX(100*t)}else if(s>20){const t=this.player.x>e.x?1:-1;e.setVelocityX(100*t)}else e.setVelocityX(0);(null==(t=e.body)?void 0:t.touching.down)&&0===Phaser.Math.Between(0,200)&&e.setVelocityY(Phaser.Math.Between(-200,-800))}}))}}class l extends s.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text"),t(this,"score",0)}init(e){this.score=e.score}create(){var e;this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680);const t=this.scale.width/2,s=this.scale.height/2;this.background=this.add.image(t,s,"background"),this.background.setAlpha(.5),this.gameover_text=this.add.text(t,s,`Game Over\nScore: ${this.score??0}`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5);const a=null==(e=this.input.keyboard)?void 0:e.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);null==a||a.once("down",(()=>{this.scene.start("MainMenu")}))}}class h extends s.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"logo"),t(this,"title"),t(this,"subtitle")}create(){var e;const t=this.scale.width/2,s=this.scale.height/2;this.background=this.add.image(t,s,"background"),this.logo=this.add.image(t,s-84,"logo"),this.subtitle=this.add.text(t,s+100,"PRESS SPACE TO START",{fontFamily:"Arial Black",fontSize:40,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5);const a=null==(e=this.input.keyboard)?void 0:e.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);null==a||a.once("down",(()=>{this.scene.start("Game")}))}}class o extends s.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png")}create(){this.scene.start("MainMenu")}}const n=600,c={type:Phaser.AUTO,width:800,height:n,parent:"game-container",backgroundColor:"#028af8",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:2e3},debug:!1}},scene:[a,o,h,r,l]};new s.Game(c);
